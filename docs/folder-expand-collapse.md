# 文件夹快速展开/折叠功能

## 功能概述

v1.9.0 新增文件夹快速展开和折叠功能，让您可以更方便地浏览大型项目的文件结构。

## 功能特性

### 🗂️ 文件夹操作按钮

在侧边栏顶部新增两个按钮：

1. **📂 展开所有文件夹** - 一键展开文件树中的所有文件夹
2. **📁 折叠所有文件夹** - 一键折叠所有文件夹，显示简洁视图

### 🎯 自动展开路径

打开文件时，自动展开该文件所在的所有父文件夹，并：
- 自动滚动到文件位置
- 高亮显示当前文件
- 确保文件在可视区域内

## 使用方法

### 1. 展开所有文件夹

**场景**：想要查看项目的完整目录结构

**操作**：
1. 点击侧边栏顶部的 **📂** 图标（文件夹树图标）
2. 所有文件夹会立即展开
3. 显示提示："已展开所有文件夹"

**快捷键**：暂无（可在未来版本添加）

### 2. 折叠所有文件夹

**场景**：文件树太长，想要简化视图

**操作**：
1. 点击侧边栏顶部的 **📁** 图标（文件夹减号图标）
2. 所有文件夹会立即折叠
3. 显示提示："已折叠所有文件夹"

### 3. 打开文件自动展开

**场景**：打开文件后想知道它在哪个文件夹

**自动行为**：
1. 通过文件树点击打开文件
2. 或通过搜索打开文件
3. 或通过链接跳转打开文件
4. 系统自动展开该文件路径上的所有父文件夹
5. 自动滚动到文件位置并高亮

**示例**：
```
根目录
├── docs
│   ├── guides        ← 自动展开
│   │   ├── api       ← 自动展开
│   │   │   └── authentication.md  ← 当前文件，高亮显示
│   │   └── tutorials
│   └── README.md
└── src
```

## 工具栏布局

侧边栏顶部的按钮布局：

```
┌─────────────────────────────────────┐
│  📂 打开文件夹  🔄  📂  📁          │
└─────────────────────────────────────┘
```

- **📂 打开文件夹** - 主按钮，打开新文件夹
- **🔄** - 刷新文件列表
- **📂** - 展开所有文件夹
- **📁** - 折叠所有文件夹

## 使用技巧

### 1. 浏览大型项目

对于有很多嵌套文件夹的项目：

1. **首次打开**：使用"展开所有"快速了解项目结构
2. **日常使用**：保持折叠状态，让自动展开功能引导你到需要的文件
3. **需要导航**：再次"展开所有"查看全局

### 2. 配合搜索使用

1. 使用搜索框查找文件
2. 点击搜索结果打开文件
3. 自动展开功能会显示文件的完整路径
4. 了解文件在项目中的位置

### 3. 清理视图

文件树太长时：
1. 点击"折叠所有"
2. 只保留一级目录可见
3. 需要时手动展开感兴趣的文件夹

### 4. 快速对比

在两个文件之间切换：
1. 打开第一个文件 → 自动展开路径
2. 打开第二个文件 → 自动展开路径
3. 两个文件的路径都保持展开状态
4. 方便看出它们的位置关系

## 实现细节

### 展开所有文件夹

```javascript
expandAllFolders() {
    // 查找所有文件夹元素
    const allFolders = document.querySelectorAll('.tree-children');
    const allChevrons = document.querySelectorAll('.chevron');
    
    // 添加 'open' 类
    allFolders.forEach(folder => folder.classList.add('open'));
    allChevrons.forEach(chevron => chevron.classList.add('open'));
}
```

### 折叠所有文件夹

```javascript
collapseAllFolders() {
    // 移除 'open' 类
    allFolders.forEach(folder => folder.classList.remove('open'));
    allChevrons.forEach(chevron => chevron.classList.remove('open'));
}
```

### 自动展开路径

```javascript
expandPathToFile(filePath) {
    // 分解路径: "docs/guides/api/auth.md" 
    // → ["docs", "guides", "api", "auth.md"]
    const pathParts = filePath.split('/');
    
    // 逐级展开
    for (let i = 1; i < pathParts.length; i++) {
        const partialPath = pathParts.slice(0, i).join('/');
        // 查找并展开该层文件夹
        expandFolder(partialPath);
    }
}
```

## 性能考虑

### 大型项目优化

- **展开所有**：使用 `querySelectorAll` 批量操作，性能良好
- **自动展开**：只展开路径上的文件夹，不影响其他部分
- **DOM操作**：使用 CSS 类而非样式，减少重绘

### 文件树大小建议

- ✅ **< 500 文件**：所有功能流畅
- ⚠️ **500-1000 文件**：展开所有可能稍慢（< 1秒）
- ❌ **> 1000 文件**：建议分批展开，避免一次性展开所有

## 键盘快捷键（建议）

虽然当前版本没有快捷键，但可以在未来添加：

| 操作 | 建议快捷键 | 说明 |
|------|-----------|------|
| 展开所有 | `Ctrl+E` | Expand All |
| 折叠所有 | `Ctrl+Shift+E` | Collapse All |
| 定位当前文件 | `Ctrl+L` | Locate File |

## 注意事项

1. **展开所有**：对于超大项目（>1000文件），可能需要等待1-2秒
2. **滚动位置**：展开/折叠不会改变当前滚动位置
3. **文件选中**：折叠后，当前选中的文件标记仍然保留
4. **搜索状态**：展开/折叠会清除搜索高亮

## 常见问题

### Q: 展开所有后文件树太长怎么办？

**A**: 使用搜索框快速定位，或点击"折叠所有"恢复简洁视图。

### Q: 自动展开会影响已展开的其他文件夹吗？

**A**: 不会。只展开当前文件路径上的文件夹，不影响其他部分。

### Q: 可以记住展开状态吗？

**A**: 当前版本不记住。刷新页面后，所有文件夹恢复为折叠状态。未来可能添加此功能。

### Q: 为什么点击文件夹图标没反应？

**A**: 确保已打开文件夹。如果文件树为空，需要先点击"打开文件夹"。

## 相关功能

- [文件树搜索](./quick-start.md#搜索文件) - 配合使用更高效
- [最近打开文件夹](./folder-memory.md) - 快速切换项目
- [文件链接跳转](./link-navigation-guide.md) - 自动展开目标文件

## 更新日志

- **v1.9.0** (2026-01-12)
  - ✨ 新增展开所有文件夹按钮
  - ✨ 新增折叠所有文件夹按钮
  - ✨ 打开文件时自动展开路径
  - 🎨 自动滚动到当前文件
  - 📝 添加使用文档

## 反馈与建议

如果您有任何建议，比如：
- 需要键盘快捷键
- 需要记住展开状态
- 需要部分展开/折叠
- 其他功能建议

欢迎提供反馈！
